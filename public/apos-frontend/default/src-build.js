(()=>{"use strict";!function(){window.apos=window.apos||{};var e=document.body&&document.body.getAttribute("data-apos");if(Object.assign(window.apos,JSON.parse(e||"{}")),e&&document.body.removeAttribute("data-apos"),window.apos.modules)for(const e of Object.values(window.apos.modules))e.alias&&(window.apos[e.alias]=e)}(),(()=>{const e=window.apos;e.util={},e.util.emit=function(t,o,n){let s;try{s=new window.CustomEvent(o)}catch(e){s=document.createEvent("Event"),s.initEvent(o,!0,!0)}e.util.assign(s,n||{}),t.dispatchEvent(s)},e.util.getCookie=function(e){const t=document.cookie.match(new RegExp("(^| )"+e+"=([^;]+)"));return t&&t[2]},e.util.removeClass=function(e,t){e.classList?e.classList.remove(t):e.className=e.className.replace(new RegExp("(^|\\b)"+t.split(" ").join("|")+"(\\b|$)","gi")," ")},e.util.addClass=function(e,t){e.classList?e.classList.add(t):e.className+=" "+t},e.util.closest=function(e,t){return e.closest||(Element.prototype.matches||(Element.prototype.matches=Element.prototype.msMatchesSelector||Element.prototype.webkitMatchesSelector),Element.prototype.closest=function(e){let t=this;if(!document.documentElement.contains(t))return null;do{if(t.matches(e))return t;t=t.parentElement||t.parentNode}while(null!==t&&1===t.nodeType);return null}),e.closest(t)},e.util.assign=function(e,t){if(Object.assign)return Object.assign.apply(Object,arguments);let o,n,s,r;for(o=1;o<arguments.length;o++)for(s=Object.keys(arguments[o]),n=0;n<s.length;n++)r=s[n],e[r]=arguments[o][r];return e},e.util.widgetPlayers={},e.util.onReadyAndRefresh=function(t){!function(e){"loading"!==document.readyState?setTimeout(e,0):document.addEventListener?document.addEventListener("DOMContentLoaded",e):document.attachEvent("onreadystatechange",(function(){"loading"!==document.readyState&&e()}))}(t),setTimeout((function(){e.bus&&e.bus.$on("refreshed",t)}),0)},e.util.onReady=e.util.onReadyAndRefresh.bind(e.util.onReadyAndRefresh),e.util.runPlayers=function(t){const o=e.util.widgetPlayers,n=Object.keys(o);for(let e=0;e<n.length;e++){const s=o[n[e]];(t||document).querySelectorAll(s.selector).forEach((function(e){e.aposWidgetPlayed||(e.aposWidgetPlayed=!0,s.player(e))}))}},e.bus||e.util.onReadyAndRefresh((function(){e.util.runPlayers()})),e.util.attachmentUrl=function(t,o){let n,s,r=e.uploadsUrl+"/attachments/"+t._id+"-"+t.name;return o||(o={}),o.crop&&o.crop.width?n=o.crop:t.crop&&t.crop.width&&(n=t.crop),n&&(r+="."+n.left+"."+n.top+"."+n.width+"."+n.height),s=!(!o.size||"original"===o.size)&&o.size,s&&(r+="."+s),r+"."+t.extension},e.util.assetUrl=function(t){return e.assetBaseUrl+t},e.util.sameSite=function(e){const t=e.match(/^(https?:)?\/\/([^/]+)/);return!t||window.location.host===t[2]}})(),(()=>{const e={},t=window.apos;t.http={},t.http.post=function(e,o,n){return t.http.remote("POST",e,o,n)},t.http.get=function(e,o,n){return t.http.remote("GET",e,o,n)},t.http.patch=function(e,o,n){return t.http.remote("PATCH",e,o,n)},t.http.put=function(e,o,n){return t.http.remote("PUT",e,o,n)},t.http.delete=function(e,o,n){return t.http.remote("DELETE",e,o,n)},t.http.remote=function(o,n,s,r){if(!r){if(!window.Promise)throw new Error("If you wish to receive a promise from apos.http methods in older browsers you must have a Promise polyfill. If you do not want to provide one, pass a callback instead.");return new window.Promise((function(e,r){return n?t.http.remote(o,n,s,(function(t,o){return t?r(t):e(o)})):r(new Error("url is not defined"))}))}if(!n)return r(new Error("url is not defined"));let i,a;t.prefix&&!1!==s.prefix&&"/"===n.substring(0,1)&&(n=t.prefix+n),null!=s.draft&&(s.qs?s.qs=s.draft?t.util.assign({aposMode:"draft"},s.qs):t.util.assign({aposMode:"published"},s.qs):(a=n.indexOf("?"),i=-1!==a?t.http.parseQuery(n.substring(a)):{},i.aposMode=s.draft?"draft":"published",n=t.http.addQueryToUrl(n,i)));const u=!0===s.busy?"busy":s.busy,d=new XMLHttpRequest;let l,c,p=s.body;s.qs&&(n=t.http.addQueryToUrl(n,s.qs)),s.busy&&(e[u]||(e[u]=0,t.bus&&t.bus.$emit("busy",{active:!0,name:u})),e[u]++),d.open(o,n);const f=window.FormData&&p instanceof window.FormData,h="json"===s.send||s.body&&"object"==typeof s.body&&!f;if(h&&d.setRequestHeader("Content-Type","application/json"),s.headers)for(l=Object.keys(s.headers),c=0;c<l.length;c++)d.setRequestHeader(l[c],s.headers[l[c]]);function m(){const e=d.getAllResponseHeaders();if(!e)return{};const t=e.trim().split(/[\r\n]+/),o={};return t.forEach((function(e){const t=e.split(": "),n=t.shift();if(!n)return;const s=t.shift();o[n.toLowerCase()]=s})),o}t.util.emit(document.body,"apos-before-"+o.toLowerCase(),{uri:n,data:s.body,request:d}),p=h?JSON.stringify(s.body):s.body,d.addEventListener("load",(function(){let e=null;const t=this.getResponseHeader("Content-Type");if(t||"json"===s.parse)if("json"===s.parse||t.match(/^application\/json/))try{e=JSON.parse(this.responseText)}catch(e){return r(e)}else e=this.responseText;if(d.status<400)return s.fullResponse?r(null,{body:e,status:d.status,headers:m()}):r(null,e);{const t=new Error(e&&e.message||e&&e.name||"Error");return t.status=d.status,t.name=e&&e.name,t.body=e,t.headers=m(),r(t)}})),d.addEventListener("abort",(function(e){return r(e)})),d.addEventListener("error",(function(e){return r(e)})),s.downloadProgress&&d.addEventListener("progress",(function(e){s.downloadProgress(e.loaded,e.lengthComputable?e.total:null)})),d.upload&&s.uploadProgress&&d.upload.addEventListener("progress",(function(e){s.uploadProgress(e.loaded,e.lengthComputable?e.total:null)})),d.addEventListener("loadend",(function(o){s.busy&&(e[u]--,e[u]||t.bus&&t.bus.$emit("busy",{active:!1,name:u}))})),d.send(p)},t.http.parseQuery=function(e){e=e.replace(/^\?/,"");const t={};return e.split("&").forEach((function(e){let t;-1===e.indexOf("=")?o(e,null):(t=e.split("="),t&&o(t[0],t[1]))})),t.root||{};function o(e,o){let n,s="root",r=t;(e=decodeURIComponent(e)).split("[").forEach((function(e){"]"===e?(Array.isArray(r[s])||(r[s]=[]),r=r[s],s=r.length):e.match(/^\d+]/)?(n=e.match(/^\d+/),Array.isArray(r[s])||(r[s]=[]),r=r[s],s=parseInt(n)):(n=e.replace("]",""),r[s]||(r[s]={}),r=r[s],s=n)})),o=null===o?o:decodeURIComponent(o),Array.isArray(r[s])?r[s].push(o):void 0!==r[s]?r[s]=[r[s],o]:r[s]=o}},t.http.addQueryToUrl=function(e,t){let o="";const n=e.indexOf("#");let s,r;if(-1!==n&&(o=e.substring(n),e=e.substring(0,n)),e=e.replace(/\?.*$/,""),null!=t&&"object"==typeof t)for(r=function e(t,o){let n,s,r=[];if(Array.isArray(o))for(s=0;s<o.length;s++)i(s,o[s]);else for(n=Object.keys(o),s=0;s<n.length;s++)i(n[s],o[n[s]]);return r;function i(o,n){null!=n&&"object"==typeof n?r=r.concat(e(t.length?t+"["+o+"]":o,n)):r.push([t.length?t+"["+o+"]":o,n])}}("",t),s=0;s<r.length;s++){const t=r[s][0],o=r[s][1];e+=s>0?"&":"?",e+=null==o?encodeURIComponent(t):encodeURIComponent(t)+"="+encodeURIComponent(o)}return e+o}})(),function(){const e=!(apos.login&&apos.login.user),t="true"===apos.util.getCookie(`${self.apos.shortName}.loggedIn`);if(!e||!t)return void sessionStorage.setItem("aposRefreshedPages","{}");const o=JSON.parse(sessionStorage.aposRefreshedPages||"{}");o[location.href]||(o[location.href]=!0,sessionStorage.setItem("aposRefreshedPages",JSON.stringify(o)),console.info("Received logged-out content from cache while logged-in, refreshing the page"),location.reload())}(),apos.util.widgetPlayers["@apostrophecms/video"]={selector:"[data-apos-video-widget]",player:function(e){const t=e.getAttribute("data-apos-video-url");let o;function n(e){e.style.height=o.height/o.width*e.offsetWidth+"px"}function s(){document.contains(e)?n(e.querySelector("[data-apos-video-canvas]")):window.removeEventListener("resize",s)}function r(t){apos.util.removeClass(e,"apos-oembed-busy"),apos.util.addClass(e,"apos-oembed-invalid"),console.error(t),e.innerHTML="undefined"!==t?"<p>Error loading video</p>":""}t&&function(e,t){if(apos.util.removeClass(e,"apos-oembed-invalid"),apos.util.addClass(e,"apos-oembed-busy"),!t.url)return r("undefined");!function(e,t){const o={qs:{url:e.url}};apos.http.get("/api/v1/@apostrophecms/oembed/query",o,t)}(t,(function(i,a){return o=a,i||t.type&&a.type!==t.type?r(i||"inappropriate"):(apos.util.removeClass(e,"apos-oembed-busy"),function(e,t){const o=document.createElement("div");o.innerHTML=t.html;const r=o.firstChild;r.setAttribute("data-apos-video-canvas",""),e.innerHTML="",r&&(r.removeAttribute("width"),r.removeAttribute("height"),e.append(r),setTimeout((function(){t.width&&t.height&&(r.style.width="100%",n(r),window.addEventListener("resize",s))}),0))}(e,a))}))}(e,{url:t})}}})();
//# sourceMappingURL=src-build.js.map